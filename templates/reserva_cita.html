{% extends "base.html" %}

{% block title %}Reserva tu Cita - {{ content.site_info.name }}{% endblock %}

{% block content %}
<!-- Header Section -->
<section class="page-header bg-gradient-primary text-white py-5">
    <div class="container">
        <div class="row text-center">
            <div class="col-lg-8 mx-auto">
                <h1 class="display-4 fw-bold mb-4">{{ content.reserva_cita.title }}</h1>
                <p class="lead">{{ content.reserva_cita.subtitle }}</p>
            </div>
        </div>
    </div>
</section>

<!-- Pasos del proceso -->
<section class="booking-steps py-5 bg-light">
    <div class="container">
        <div class="row">
            {% for step in content.reserva_cita.steps %}
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="step-card text-center">
                    <div class="step-number">{{ step.number }}</div>
                    <h5 class="fw-bold mb-3">{{ step.title }}</h5>
                    <p class="text-muted">{{ step.description }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Formulario de reserva -->
<section class="booking-form py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="form-container bg-white rounded shadow p-4">
                    <h3 class="text-center mb-4">Formulario de Reserva</h3>
                    
                    <form id="bookingForm">
                        <!-- Información personal -->
                        <div class="form-section mb-4">
                            <h5 class="fw-bold mb-3">Información Personal</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="firstName" class="form-label">Nombres *</label>
                                    <input type="text" class="form-control" id="firstName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="lastName" class="form-label">Apellidos *</label>
                                    <input type="text" class="form-control" id="lastName" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="document" class="form-label">Documento de Identidad *</label>
                                    <input type="text" class="form-control" id="document" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="birthDate" class="form-label">Fecha de Nacimiento *</label>
                                    <input type="date" class="form-control" id="birthDate" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="phone" class="form-label">Teléfono *</label>
                                    <input type="tel" class="form-control" id="phone" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label">Correo Electrónico *</label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                            </div>
                        </div>

                        <!-- Selección de servicio -->
                        <div class="form-section mb-4">
                            <h5 class="fw-bold mb-3">Servicio Solicitado</h5>
                            <div class="mb-3">
                                <label for="serviceType" class="form-label">Tipo de Estudio *</label>
                                <select class="form-control" id="serviceType" required>
                                    <option value="">Selecciona un servicio...</option>
                                    {% for service in content.reserva_cita.services_available %}
                                    <option value="{{ service }}">{{ service }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="bodyPart" class="form-label">Parte del Cuerpo/Región</label>
                                <input type="text" class="form-control" id="bodyPart" 
                                       placeholder="Ej: Rodilla derecha, Tórax, Abdomen">
                            </div>
                            <div class="mb-3">
                                <label for="urgency" class="form-label">Urgencia</label>
                                <select class="form-control" id="urgency">
                                    <option value="normal">Normal (2-3 días)</option>
                                    <option value="priority">Prioritario (24-48 horas)</option>
                                    <option value="urgent">Urgente (Mismo día)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Fecha y hora preferida -->
                        <div class="form-section mb-4">
                            <h5 class="fw-bold mb-3">Fecha y Hora Preferida</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="preferredDate" class="form-label">Fecha Preferida *</label>
                                    <input type="date" class="form-control" id="preferredDate" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="preferredTime" class="form-label">Hora Preferida *</label>
                                    <select class="form-control" id="preferredTime" required>
                                        <option value="">Selecciona una hora...</option>
                                        <option value="08:00">08:00 AM</option>
                                        <option value="09:00">09:00 AM</option>
                                        <option value="10:00">10:00 AM</option>
                                        <option value="11:00">11:00 AM</option>
                                        <option value="14:00">02:00 PM</option>
                                        <option value="15:00">03:00 PM</option>
                                        <option value="16:00">04:00 PM</option>
                                        <option value="17:00">05:00 PM</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="alternativeDate" class="form-label">Fecha Alternativa</label>
                                <input type="date" class="form-control" id="alternativeDate">
                            </div>
                        </div>

                        <!-- Información médica -->
                        <div class="form-section mb-4">
                            <h5 class="fw-bold mb-3">Información Médica</h5>
                            <div class="mb-3">
                                <label for="referringDoctor" class="form-label">Médico Remitente</label>
                                <input type="text" class="form-control" id="referringDoctor">
                            </div>
                            <div class="mb-3">
                                <label for="symptoms" class="form-label">Síntomas o Motivo del Estudio</label>
                                <textarea class="form-control" id="symptoms" rows="3" 
                                          placeholder="Describe brevemente los síntomas o el motivo médico"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="allergies" class="form-label">Alergias Conocidas</label>
                                <input type="text" class="form-control" id="allergies" 
                                       placeholder="Especifica cualquier alergia, especialmente a contrastes">
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="pregnant">
                                    <label class="form-check-label" for="pregnant">
                                        ¿Está embarazada o podría estarlo? (Pacientes femeninas)
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Términos y condiciones -->
                        <div class="form-section mb-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="terms" required>
                                <label class="form-check-label" for="terms">
                                    Acepto los <a href="#" class="text-primary">términos y condiciones</a> 
                                    y autorizo el tratamiento de mis datos personales *
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="notifications">
                                <label class="form-check-label" for="notifications">
                                    Deseo recibir recordatorios por WhatsApp y correo electrónico
                                </label>
                            </div>
                        </div>

                        <!-- Botones -->
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg me-3">
                                <i class="fas fa-calendar-check me-2"></i>Confirmar Reserva
                            </button>
                            <button type="reset" class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-undo me-2"></i>Limpiar Formulario
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Información adicional -->
<section class="booking-info py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 mb-4">
                <div class="info-card text-center">
                    <div class="contact-icon mx-auto">
                        <i class="fas fa-phone"></i>
                    </div>
                    <h5 class="fw-bold">¿Prefieres Llamar?</h5>
                    <p class="text-muted mb-3">Nuestro equipo está disponible para ayudarte</p>
                    <a href="tel:{{ content.site_info.phone }}" class="btn btn-primary">
                        {{ content.site_info.phone }}
                    </a>
                </div>
            </div>
            <div class="col-lg-4 mb-4">
                <div class="info-card text-center">
                    <div class="contact-icon mx-auto">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <h5 class="fw-bold">WhatsApp</h5>
                    <p class="text-muted mb-3">Agenda rápidamente por WhatsApp</p>
                    <a href="https://wa.me/{{ content.site_info.whatsapp.replace('+', '').replace(' ', '') }}" 
                       class="btn btn-success" target="_blank">
                        {{ content.site_info.whatsapp }}
                    </a>
                </div>
            </div>
            <div class="col-lg-4 mb-4">
                <div class="info-card text-center">
                    <div class="contact-icon mx-auto">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h5 class="fw-bold">Horarios</h5>
                    <p class="text-muted mb-3">Lun-Vie: 7AM-7PM<br>Sáb: 8AM-4PM<br>Dom: 9AM-1PM</p>
                    <a href="{{ url_for('contacto') }}" class="btn btn-outline-primary">
                        Ver Detalles
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('bookingForm');
    const preferredDateInput = document.getElementById('preferredDate');
    
    // Establecer fecha mínima (mañana)
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    preferredDateInput.min = tomorrow.toISOString().split('T')[0];
    
    // Manejar envío del formulario
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Recopilar datos del formulario
        const formData = new FormData(form);
        const bookingData = Object.fromEntries(formData.entries());
        
        // Mostrar loading
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Procesando...';
        submitBtn.disabled = true;
        
        // Simular envío (en producción se enviaría al servidor)
        setTimeout(function() {
            alert('¡Cita reservada exitosamente! Te contactaremos pronto para confirmación.');
            
            // Restaurar botón
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
            
            // Limpiar formulario
            form.reset();
        }, 2000);
    });
    
    // Validación en tiempo real
    const requiredFields = form.querySelectorAll('[required]');
    requiredFields.forEach(field => {
        field.addEventListener('blur', function() {
            if (!this.value.trim()) {
                this.classList.add('is-invalid');
            } else {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            }
        });
    });
});
</script>
{% endblock %}
